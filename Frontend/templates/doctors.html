{% extends "base.html" %}
{% block title %}Doctors{% endblock %}
{% block content %}
<h2>Doctors</h2>

<!-- Add or Edit Doctor Form -->
<form method="post" class="mb-4">
  {% if editing_doctor %}
    <input type="hidden" name="editdoctor_id" value="{{ editing_doctor.id }}">
  {% endif %}
  <div class="mb-3">
    <input type="text" name="name" placeholder="Doctor Name" class="form-control" required value="{{ editing_doctor.name if editing_doctor else '' }}">
  </div>
  <div class="mb-3">
    <input type="text" name="contact_number" placeholder="Contact Number" class="form-control" value="{{ editing_doctor.contact_number if editing_doctor else '' }}">
  </div>
  <div class="mb-3">
    <textarea name="address" placeholder="Address" class="form-control" rows="3">{{ editing_doctor.address if editing_doctor else '' }}</textarea>
  </div>
  <button type="submit" name="{{ 'editdoctor' if editing_doctor else 'adddoctor' }}" value="1" class="btn btn-primary mb-3" onclick="return validateForm()">
    {{ 'Update Doctor' if editing_doctor else 'Add Doctor' }}
  </button>
  {% if editing_doctor %}
  <a href="{{ url_for('doctors_view') }}" class="btn btn-secondary mb-3 ms-2">Cancel Edit</a>
  {% endif %}
</form>

<table class="table table-bordered table-striped text-center" id="doctors-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Contact Number</th>
      <th>Address</th>
      <th>Edit</th>
      <th>Delete</th>
    </tr>
    <tr class="filter-row">
      <th><input type="number" class="form-control filter-input" data-column="0" placeholder="Filter ID"></th>
      <th><input type="text" class="form-control filter-input" data-column="1" placeholder="Filter Name"></th>
      <th><input type="text" class="form-control filter-input" data-column="2" placeholder="Filter Contact Number"></th>
      <th><input type="text" class="form-control filter-input" data-column="3" placeholder="Filter Address"></th>
      <th></th>
      <th><button id="clear-filters" class="btn btn-sm btn-secondary" title="Clear Filters">Ã—</button></th>
    </tr>
  </thead>
  <tbody>
    {% for doctor in doctors %}
    <tr>
      <td>{{ doctor.id }}</td>
      <td>{{ doctor.name }}</td>
      <td>{{ doctor.contact_number }}</td>
      <td>{{ doctor.address }}</td>
      <td>
        <form method="post" class="d-inline">
          <input type="hidden" name="startedit_id" value="{{ doctor.id }}">
          <button type="submit" class="btn btn-sm btn-warning">Edit</button>
        </form>
      </td>
      <td>
        <form method="post" class="d-inline" onsubmit="return confirm('Delete this doctor?');">
          <input type="hidden" name="deldoctor_id" value="{{ doctor.id }}">
          <button type="submit" class="btn btn-sm btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="6" class="text-muted">No doctors found.</td></tr>
    {% endfor %}
  </tbody>
</table>

<script>
function validateForm() {
    let name = document.querySelector('[name="name"]').value.trim();
    if (!name) {
        alert("Warning: Doctor name is required.");
        return false;
    }
    return true;
}

// Use shared filter utility
;(function(){
  function run() { if (window.ui && window.ui.applyFilters) window.ui.applyFilters('doctors-table', 'clear-filters'); }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run); else run();
})();
</script>

<button id="clear-filters" class="btn btn-secondary mt-3">Clear Filters</button>

{% endblock %}
